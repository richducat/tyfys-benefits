<!DOCTYPE html>
<html lang="en">
<head>
   <!-- Google tag (gtag.js) -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=G-L1PEBFCV9Q"></script>
   <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());

     gtag('config', 'G-L1PEBFCV9Q');
   </script>

   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
   <title>TYFYS Provider Finder | drportal</title>
   <!-- Canonical DR portal entry: /drportal.html -->
   <meta name="description" content="Find VA disability DBQ and nexus letter providers, including telehealth networks and local specialists.">
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
   <script src="https://cdn.tailwindcss.com"></script>
   <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
   <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
   <script src="https://unpkg.com/lucide-react@0.456.0/dist/umd/lucide-react.production.min.js"></script>
   <style>
     body { font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
     .animate-bounce-in { animation: bounceIn 0.4s ease; }
     @keyframes bounceIn {
       0% { opacity: 0; transform: scale(0.95) translateY(10px); }
       60% { opacity: 1; transform: scale(1.02) translateY(-4px); }
       100% { opacity: 1; transform: scale(1) translateY(0); }
     }
   </style>
</head>
<body class="bg-slate-50">
  <div id="root">
    <div class="min-h-screen bg-slate-50 font-sans text-slate-800 flex items-center justify-center px-6">
      <div class="max-w-lg text-center bg-white border border-slate-200 shadow-lg rounded-2xl p-8">
        <h1 class="text-2xl font-bold text-slate-900">Loading Provider Portal</h1>
        <p class="mt-3 text-slate-600">Please wait while the directory loads.</p>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel" data-presets="react">
    const rootElement = document.getElementById('root');
    if (!window.React || !window.ReactDOM) {
      rootElement.innerHTML = `
        <div class="min-h-screen bg-slate-50 font-sans text-slate-800 flex items-center justify-center px-6">
          <div class="max-w-lg text-center bg-white border border-slate-200 shadow-lg rounded-2xl p-8">
            <h1 class="text-2xl font-bold text-slate-900">Provider Finder is unavailable</h1>
            <p class="mt-3 text-slate-600">
              We couldn&apos;t load the required scripts. Please check your connection or content blockers and refresh the page.
            </p>
          </div>
        </div>
      `;
    } else {
      const { useState, useEffect } = React;
      const iconFallback = (props) => <span aria-hidden="true" {...props} />;
      const lucideIcons = window.lucideReact || {};
      const {
        Search = iconFallback,
        MapPin = iconFallback,
        Stethoscope = iconFallback,
        Phone = iconFallback,
        Globe = iconFallback,
        Mail = iconFallback,
        Copy = iconFallback,
        CheckCircle = iconFallback,
        AlertCircle = iconFallback,
        FileText = iconFallback,
        Video = iconFallback,
        X = iconFallback,
        Plus = iconFallback,
        UserPlus = iconFallback,
        Save = iconFallback,
        Database = iconFallback,
        Building = iconFallback,
        ExternalLink = iconFallback,
        Trash2 = iconFallback,
        Shield = iconFallback,
        ShieldCheck = iconFallback,
        MessageSquare = iconFallback,
        Loader = iconFallback,
        UserCheck = iconFallback,
        Briefcase = iconFallback,
        ClipboardList = iconFallback,
        ArrowLeft = iconFallback,
        LogIn = iconFallback,
        LogOut = iconFallback,
        Lock = iconFallback,
        RefreshCw = iconFallback,
        Smartphone = iconFallback,
        AtSign = iconFallback
      } = lucideIcons;

      const ProviderFinder = () => {
        // --- GEMINI API SETUP ---
        const apiKey = "AIzaSyCZE6qZ5HxQ9AlF5fjylwKfZHdyn03bo68"; // User provided API Key

        // --- STATE MANAGEMENT ---
        const [view, setView] = useState('list'); // 'list' or 'profile'
        const [currentProvider, setCurrentProvider] = useState(null);

        const [selectedState, setSelectedState] = useState('');
        const [selectedCondition, setSelectedCondition] = useState('All');
        const [searchQuery, setSearchQuery] = useState('');
        const [showNational, setShowNational] = useState(true);

        // Modals
        const [showAddModal, setShowAddModal] = useState(false);
        const [showLoginModal, setShowLoginModal] = useState(false);

        // Auth & Admin
        const [isAuthenticated, setIsAuthenticated] = useState(() => {
          return localStorage.getItem('auth_token') === 'stateboys_session_active';
        });
        const [loginForm, setLoginForm] = useState({ username: '', password: '' });
        const [loginError, setLoginError] = useState('');

        const [toast, setToast] = useState(null);
        const [nationalTab, setNationalTab] = useState('doctors');
        const [isScanning, setIsScanning] = useState(false);

        // --- FULL RESTORED DATABASE ---
        const initialProviders = [
          // --- ALABAMA ---
          { id: 'al-1', name: 'Dr. C. Edward Hasty, Ph.D.', state: 'Alabama', county: 'Jefferson (Birmingham)', type: 'Local', specialty: ['Mental Health', 'Psychology', 'Headaches/Migraines'], services: 'Nexus Letters, DBQs, PTSD Exams', contact: 'Search Web', phone: '205-933-5483', email: '', notes: 'Experienced forensic psychologist serving Alabama veterans.' },
          { id: 'al-2', name: 'Dr. Joey Sasser, DO', state: 'Alabama', county: 'Houston (Dothan)', type: 'Local', specialty: ['General', 'Osteopathic', 'MSK', 'Back/Lumbar'], services: 'DBQ/Exam (Broad Physical)', contact: 'Search Web', phone: '334-794-8700', email: '', notes: 'General/Osteopathic medicine.' },

          // --- ALASKA ---
          { id: 'ak-1', name: 'Telemedica (Serves AK)', state: 'Alaska', county: 'Telehealth', type: 'Local', specialty: ['General', 'Mental Health', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Remote Nexus Letters', contact: 'telemedicallc.com', phone: '', email: '', notes: 'Due to remote nature, Telemedica is the primary verified option for AK.' },

          // --- ARIZONA ---
          { id: 'az-1', name: 'David Anaise, MD, JD', state: 'Arizona', county: 'Pima (Tucson)', type: 'Local', specialty: ['General', 'Nexus Letters', 'Complex Cases', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Nexus Letters (File Reviews)', contact: 'danaise.com', phone: '520-219-2379', email: '', notes: 'Retired surgeon & lawyer. Top nexus letter doctor for complex arguments.' },
          { id: 'az-2', name: 'Prashant Sharma, MD', state: 'Arizona', county: 'Maricopa (Phoenix)', type: 'Local', specialty: ['Mental Health', 'Psychiatry', 'Headaches/Migraines'], services: 'Nexus Letters & DBQs', contact: 'concisepsych.com', phone: '', email: '', notes: 'Offers concise psych evaluations.' },
          { id: 'az-3', name: 'Dr. Paul Saiz, MD', state: 'Arizona', county: 'Statewide', type: 'Local', specialty: ['Orthopedic', 'Spine', 'Back/Lumbar', 'Extremities'], services: 'Spine trauma, Disability evaluation', contact: 'Search Web', phone: '575-526-0777', email: '', notes: 'Certified IME (CIME). Specializes in spine/back.' },
          { id: 'az-4', name: 'Aws Al Jandeel, MD', state: 'Arizona', county: 'Pima (Tucson)', type: 'Local', specialty: ['Internal Medicine', 'General'], services: 'DBQ/IMO (HTN, Diabetes, GERD/IBS)', contact: 'Search Web', phone: '', email: '', notes: '1 S Church Ave, #1200. Internal Medicine cases.' },

          // --- ARKANSAS ---
          { id: 'ar-1', name: 'Dr. Patrick Sharp, Ph.D.', state: 'Arkansas', county: 'Pulaski (Little Rock)', type: 'Local', specialty: ['Mental Health', 'Psychology'], services: 'DBQs, Nexus Letters', contact: 'Search Web', phone: '', email: '', notes: 'Specializes in psychological evaluations for veterans.' },

          // --- CALIFORNIA ---
          { id: 'ca-1', name: 'Thomas Grieder, MD, PhD', state: 'California', county: 'Los Angeles', type: 'Local', specialty: ['Mental Health', 'Psychiatry', 'Headaches/Migraines'], services: 'Nexus Letters & DBQs', contact: 'ptsdmedicalopinion.com', phone: '', email: '', notes: 'Former VA PTSD examiner.' },
          { id: 'ca-2', name: 'Victoria A. Cassano, MD, MPH', state: 'California', county: 'San Diego / San Francisco', type: 'Local', specialty: ['Toxic Exposure', 'Occupational Med', 'Headaches/Migraines'], services: 'Nexus Letters (Toxic Exposure)', contact: 'drcassano.com/veterans', phone: '', email: '', notes: 'Ret. Navy Capt. Expert in Camp Lejeune, Burn Pits.' },
          { id: 'ca-4', name: 'Dr. Emin Gharibian, Psy.D.', state: 'California', county: 'Statewide', type: 'Local', specialty: ['Mental Health', 'Neuropsychology', 'TBI'], services: 'Forensic Neuropsychology, PTSD, Dementia', contact: 'verdugopsych.com', phone: '818-533-1532', email: '', notes: 'Former trainee at Patton State Hospital.' },
          { id: 'ca-5', name: 'Dr. Michael R. Klein, Jr., MD', state: 'California', county: 'Sacramento', type: 'Local', specialty: ['Orthopedic', 'Extremities', 'Back/Lumbar'], services: 'Disability Evaluation', contact: 'mrkmedconsultants.com', phone: '916-489-4400', email: '', notes: 'Founded MRK Medical Consultants.' },
          { id: 'ca-8', name: 'Dr. Peter Laimins, MD', state: 'California', county: 'Palo Alto', type: 'Local', specialty: ['Orthopedic', 'Legs', 'Knees', 'Back/Lumbar'], services: 'QME Disability Evaluations', contact: '', phone: '650-323-9680', email: '', notes: 'Qualified Medical Evaluator (QME).' },
          { id: 'ca-9', name: 'Dr. Adam Brooks, MD', state: 'California', county: 'Los Angeles', type: 'Local', specialty: ['Internal Medicine'], services: 'QME Disability Evaluations', contact: '', phone: '800-418-7771', email: '', notes: 'Qualified Medical Evaluator (QME).' },

          // --- COLORADO ---
          { id: 'co-1', name: 'Brett Vallette, PhD', state: 'Colorado', county: 'Boulder', type: 'Local', specialty: ['Mental Health', 'TBI', 'PTSD', 'Headaches/Migraines'], services: 'Nexus Letters, IMOs, DBQ exams', contact: 'VeteransPsychEvaluations.com', phone: '303-465-3147', email: 'info@VeteransPsychEvaluations.com', notes: '25+ years conducting psych C&P exams.' },
          { id: 'co-2', name: 'Ashley Gardner, PA-C', state: 'Colorado', county: 'Denver (Telehealth)', type: 'Local', specialty: ['General Medical'], services: 'Nexus letters & DBQs', contact: 'JGardnerAndAssociates.com', phone: '970-823-4826', email: 'info@JGardnerAndAssociates.com', notes: 'Veteran-led team.' },

          // --- CONNECTICUT ---
          { id: 'ct-1', name: 'Dr. Quinn Austin-Small, Ph.D.', state: 'Connecticut', county: 'Telehealth', type: 'Local', specialty: ['Mental Health', 'Psychology'], services: 'Nexus Letters, DBQs', contact: 'qasphd.com', phone: '860-306-7243', email: '', notes: 'Clinical Psychologist specializing in veteran evaluations.' },

          // --- DELAWARE ---
          { id: 'de-1', name: 'Dr. Andrew Gelman, D.O.', state: 'Delaware', county: 'New Castle', type: 'Local', specialty: ['Forensic', 'General', 'Back/Lumbar'], services: 'Independent Medical Exams', contact: 'Search Web', phone: '302-994-0103', email: '', notes: 'Experienced in independent medical evaluations.' },

          // --- FLORIDA ---
          { id: 'fl-1', name: 'Primary Care of Orange City', state: 'Florida', county: 'Volusia', type: 'Local', specialty: ['General', 'Back/Lumbar', 'Headaches/Migraines'], services: 'Full DBQ exams & Nexus letters', contact: 'primarycareoforangecity.com', phone: '386-241-0274', email: '', notes: 'Emphasizes precise, thorough DBQs.' },
          { id: 'fl-dorto', name: 'Dr. Anthony Dorto, MD', state: 'Florida', county: 'Miami-Dade', type: 'Local', specialty: ['Physical Medicine', 'Extremities', 'Disability', 'Back/Lumbar'], services: 'Impairment Ratings', contact: 'dortomd.com', phone: '305-937-1999', email: '', notes: 'Certified Independent Medical Examiner.' },
          { id: 'fl-moering', name: 'Dr. Robert Moering, Psy.D.', state: 'Florida', county: 'Statewide', type: 'Local', specialty: ['Mental Health', 'Forensic'], services: 'Nexus Letters, DBQs', contact: 'flpfs.com', phone: '', email: '', notes: 'Florida Psychological & Forensic Services LLC.' },

          // --- GEORGIA ---
          { id: 'ga-2', name: 'K&D Veterans Medical Assessment', state: 'Georgia', county: 'Metro Atlanta', type: 'Local', specialty: ['General', 'Back/Lumbar', 'Headaches/Migraines'], services: 'DBQs, IMOs, Nexus letters', contact: 'kdvma.com', phone: '470-865-8933', email: '', notes: 'Direct physician-signed DBQs/IMOs.' },
          { id: 'ga-northside', name: 'Northside Family Practice', state: 'Georgia', county: 'Cherokee', type: 'Local', specialty: ['General', 'Family Medicine'], services: 'IME/DBQ Support', contact: 'northsidefamilypractice.com', phone: '770-926-8573', email: '', notes: 'Dr. Mitchell/Parman.' },
          { id: 'ga-woodard', name: 'Michelle E. Mason-Woodard, MD', state: 'Georgia', county: 'Columbia', type: 'Local', specialty: ['General', 'Family Medicine'], services: 'DBQ/Exam (Broad Physical)', contact: 'Search Web', phone: '', email: '', notes: '3925 Roberts Rd, Martinez, GA.' },
          { id: 'ga-ghouri', name: 'Dr. Mohommad Ghouri', state: 'Georgia', county: 'Muscogee', type: 'Local', specialty: ['Sleep Apnea', 'General'], services: 'Nexus Letters', contact: 'Contact for info', phone: '', email: '', notes: 'Noted for Sleep Apnea secondary to PTSD.' },

          // --- HAWAII ---
          { id: 'hi-1', name: 'Leah Wingeart, Ph.D.', state: 'Hawaii', county: 'Honolulu', type: 'Local', specialty: ['Mental Health', 'PTSD'], services: 'Nexus letters & DBQ evaluations', contact: 'drwingeart@gmail.com', phone: '702-342-1252', email: 'drwingeart@gmail.com', notes: 'Licensed in HI/NV/CO. PsyPACT provider.' },

          // --- IDAHO ---
          { id: 'id-1', name: 'Dr. Mark Corgiat, Ph.D.', state: 'Idaho', county: 'Ada', type: 'Local', specialty: ['Mental Health', 'Neuropsychology', 'Headaches/Migraines'], services: 'DBQs, Nexus Letters', contact: 'Search Web', phone: '208-336-6590', email: '', notes: 'Neuropsychologist experienced in veteran claims.' },

          // --- ILLINOIS ---
          { id: 'il-1', name: 'Dr. Fred Nolen, Ph.D.', state: 'Illinois', county: 'DuPage', type: 'Local', specialty: ['Mental Health', 'Psychology'], services: 'Nexus Letters, DBQs, Forensic Eval', contact: 'Contact via Email', phone: '630-668-3800', email: 'frednolen@msn.com', notes: 'Experienced in veterans disability evaluations and DBQs.' },

          // --- INDIANA ---
          { id: 'in-1', name: 'Dr. Gregory Sokol, MD', state: 'Indiana', county: 'Lake', type: 'Local', specialty: ['Cardiology', 'Internal Medicine', 'General'], services: 'IMEs, Disability Evaluations', contact: 'Search Web', phone: '219-769-1660', email: '', notes: 'Specializes in internal medicine independent exams.' },

          // --- IOWA ---
          { id: 'ia-1', name: 'Veterans Consulting (IME)', state: 'Iowa', county: 'Scott', type: 'Local', specialty: ['General', 'Back/Lumbar', 'Headaches/Migraines'], services: 'Nexus letters & IMEs', contact: 'VeteranIndependentMedicalExamination.com', phone: '', email: '', notes: 'Network of physicians covering multiple conditions.' },
          { id: 'ia-rowland', name: 'Adam Rowland, FNP', state: 'Iowa', county: 'Statewide', type: 'Local', specialty: ['General'], services: 'Nexus Letters', contact: 'Search Web', phone: '', email: '', notes: 'Veteran FNP providing nexus letters.' },

          // --- KANSAS ---
          { id: 'ks-1', name: 'Dr. Jennifer Sweeton, Psy.D.', state: 'Kansas', county: 'Johnson', type: 'Local', specialty: ['Mental Health', 'PTSD'], services: 'DBQs & Nexus letters', contact: 'veteransmentalhealthevaluationservices.com', phone: '', email: '', notes: 'Forensic evaluations for KS/MO area.' },

          // --- KENTUCKY ---
          { id: 'ky-1', name: 'Dr. David Allen, MD', state: 'Kentucky', county: 'Statewide', type: 'Local', specialty: ['Psychiatry', 'Sleep Apnea', 'Headaches/Migraines'], services: 'Video visits, Nexus Letters', contact: 'Search Web', phone: '', email: '', notes: 'Serves KY/TN area. Known as "Nexus Letter Doctor".' },

          // --- LOUISIANA ---
          { id: 'la-1', name: 'Dr. Charles M. Blow, MD', state: 'Louisiana', county: 'Caddo', type: 'Local', specialty: ['General', 'Family Medicine', 'Back/Lumbar'], services: 'Disability Evaluations', contact: 'Search Web', phone: '', email: '', notes: 'Experienced with VA exams and general disability.' },

          // --- MAINE ---
          { id: 'me-1', name: 'Dr. John P. Zeller, MD', state: 'Maine', county: 'Cumberland', type: 'Local', specialty: ['Internal Medicine', 'General'], services: 'IMEs', contact: 'Search Web', phone: '207-774-2666', email: '', notes: 'Provides Independent Medical Exams.' },

          // --- MARYLAND ---
          { id: 'md-bash', name: 'Dr. Craig Bash, MD', state: 'Maryland', county: 'Montgomery', type: 'Local', specialty: ['General', 'Neuroradiology', 'Spine', 'Back/Lumbar', 'Headaches/Migraines'], services: 'Nexus letters, IMEs', contact: 'veteransmedadvisor.com', phone: '301-717-0922', email: 'drbash@doctor.com', notes: 'Known as "Dr. Bash". Premium service for complex appeals/spine/head.' },
          { id: 'md-jorge', name: 'Melinda Jorge, MD', state: 'Maryland', county: 'Prince George\'s', type: 'Local', specialty: ['General', 'Family Medicine'], services: 'DBQ/Exam (Primary Care + Chronic Conditions)', contact: 'Search Web', phone: '', email: '', notes: '4600 Forbes Blvd Ste. A26-301.' },

          // --- MASSACHUSETTS ---
          { id: 'ma-1', name: 'Dr. Brian Stone, MD', state: 'Massachusetts', county: 'Suffolk', type: 'Local', specialty: ['Internal Medicine', 'General', 'Headaches/Migraines'], services: 'Nexus Letters, Record Review', contact: 'Search Web', phone: '', email: '', notes: 'Specializes in internal medicine claims reviews.' },

          // --- MICHIGAN ---
          { id: 'mi-1', name: 'Dr. David Bracciano, Ph.D.', state: 'Michigan', county: 'Statewide', type: 'Local', specialty: ['Mental Health', 'Psychology'], services: 'Psychological Evaluations, Nexus Letters', contact: 'braccianopsychology.com', phone: '269-409-1424', email: '', notes: 'Clinical psychologist experienced with VA claims.' },

          // --- MINNESOTA ---
          { id: 'mn-1', name: 'Dr. T. Michael Speidel, MD', state: 'Minnesota', county: 'Hennepin', type: 'Local', specialty: ['Orthopedic', 'Extremities', 'Back/Lumbar'], services: 'IMEs', contact: 'Search Web', phone: '952-922-5556', email: '', notes: 'Orthopedic specialist performing IMEs.' },

          // --- MISSISSIPPI ---
          { id: 'ms-1', name: 'Dr. John W. Ellis, MD', state: 'Mississippi', county: 'Regional Coverage', type: 'Local', specialty: ['General', 'Legal Medicine', 'Back/Lumbar', 'Headaches/Migraines'], services: 'IMOs, DBQs', contact: 'ellisclinic.com', phone: '844-625-5300', email: '', notes: 'Dr. Ellis (OK) frequently serves MS veterans via record review/travel.' },

          // --- MISSOURI ---
          { id: 'mo-1', name: 'Jennifer Sweeton, Psy.D.', state: 'Missouri', county: 'Jackson', type: 'Local', specialty: ['Mental Health', 'PTSD', 'MST', 'TBI', 'Headaches/Migraines'], services: 'DBQs & Nexus letters', contact: 'veteransmentalhealthevaluationservices.com', phone: '', email: '', notes: 'Specializes in high-quality forensic evaluations.' },

          // --- MONTANA ---
          { id: 'mt-1', name: 'Telemedica (Serves MT)', state: 'Montana', county: 'Telehealth', type: 'Local', specialty: ['General', 'Mental Health', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Remote Nexus Letters', contact: 'telemedicallc.com', phone: '', email: '', notes: 'Primary option for MT veterans.' },

          // --- NEBRASKA ---
          { id: 'ne-1', name: 'Dr. Thomas A. Zuercher, MD', state: 'Nebraska', county: 'Douglas', type: 'Local', specialty: ['Family Medicine', 'General', 'Back/Lumbar'], services: 'Disability Exams', contact: 'Search Web', phone: '402-393-3400', email: '', notes: 'Experienced in general disability evaluations.' },

          // --- NEVADA ---
          { id: 'nv-1', name: 'Leah Wingeart, Psy.D.', state: 'Nevada', county: 'Clark', type: 'Local', specialty: ['Mental Health'], services: 'Nexus letters & DBQs', contact: 'shrinkwraptlasvegas.com', phone: '702-342-1252', email: 'drwingeart@gmail.com', notes: 'ShrinkWrapt Las Vegas. Forensic expertise.' },
          { id: 'nv-2', name: 'Jerald "Jay" Cook, MD', state: 'Nevada', county: 'Douglas', type: 'Local', specialty: ['Toxic Exposure', 'Occupational Med'], services: 'Nexus letters', contact: 'medfitconsulting.com', phone: '858-858-9052', email: '', notes: 'Navy veteran. Expert in exposures/lifestyle medicine.' },

          // --- NEW HAMPSHIRE ---
          { id: 'nh-1', name: 'Dr. Robert Sobel, MD', state: 'New Hampshire', county: 'Hillsborough', type: 'Local', specialty: ['Orthopedic', 'Back/Lumbar', 'Joints'], services: 'IMEs', contact: 'Search Web', phone: '', email: '', notes: 'Orthopedic IMEs.' },

          // --- NEW JERSEY ---
          { id: 'nj-1', name: 'Dr. David Weiss, D.O.', state: 'New Jersey', county: 'Mercer', type: 'Local', specialty: ['Orthopedic', 'Extremities', 'Back/Lumbar'], services: 'Nexus Letters, DBQs', contact: 'nbinjury.com', phone: '609-896-0303', email: '', notes: 'Highly regarded in VA circles for complex orthopedic/back/extremity claims.' },

          // --- NEW MEXICO ---
          { id: 'nm-1', name: 'Dr. Paul Saiz, MD', state: 'New Mexico', county: 'Dona Ana', type: 'Local', specialty: ['Orthopedic', 'Spine', 'Back/Lumbar'], services: 'Spine trauma, Disability evaluation', contact: 'Search Web', phone: '575-526-0777', email: '', notes: 'Covers NM/TX/AZ.' },

          // --- NEW YORK ---
          { id: 'ny-1', name: 'David Anaise, MD, JD', state: 'New York', county: 'New York City', type: 'Local', specialty: ['General', 'Nexus Letters', 'Back/Lumbar', 'Headaches/Migraines'], services: 'Nexus Letters (File Reviews only)', contact: 'danaise.com', phone: '520-219-2379', email: '', notes: 'Often handles NY cases. Retired surgeon & lawyer.' },
          { id: 'ny-2', name: 'Dr. Eytan Raz, MD', state: 'New York', county: 'New York City', type: 'Local', specialty: ['Radiology', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Authorized Provider (NY WCB)', contact: '', phone: '212-263-5668', email: '', notes: 'NY Workers Comp Board Authorized. Neuroradiology.' },
          { id: 'ny-3', name: 'Dr. Jonathan Patrick Riley, MD', state: 'New York', county: 'New York City', type: 'Local', specialty: ['Neurosurgery', 'Back/Lumbar', 'Headaches/Migraines'], services: 'Authorized Provider (NY WCB)', contact: '', phone: '212-746-2363', email: '', notes: 'NY Workers Comp Board Authorized. Neurosurgery.' },

          // --- NORTH CAROLINA ---
          { id: 'nc-1', name: 'Mark D. Worthen, Psy.D.', state: 'North Carolina', county: 'Mecklenburg', type: 'Local', specialty: ['Mental Health', 'Forensic Psychology'], services: 'IMEs, Nexus opinions, DBQs', contact: 'drworthen.net', phone: '980-391-6309', email: '', notes: 'Forensic competence. Will not write nexus without review.' },
          { id: 'nc-allen', name: 'Dr. Jessica Allen, MD', state: 'North Carolina', county: 'Durham', type: 'Local', specialty: ['Mental Health', 'Psychiatry'], services: 'Nexus Letters', contact: 'ptsdnc.com', phone: '', email: '', notes: 'Psychiatrist. PTSD NC.' },
          { id: 'nc-etheridge', name: 'Dr. Roy Etheridge, Ph.D.', state: 'North Carolina', county: 'Wake', type: 'Local', specialty: ['Mental Health'], services: 'Nexus Letters', contact: 'etheridgepsychology.com', phone: '', email: '', notes: 'Psychologist.' },

          // --- NORTH DAKOTA ---
          { id: 'nd-1', name: 'Telemedica (Serves ND)', state: 'North Dakota', county: 'Telehealth', type: 'Local', specialty: ['General', 'Mental Health', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Remote Nexus Letters', contact: 'telemedicallc.com', phone: '', email: '', notes: 'Primary option for ND veterans.' },

          // --- OHIO ---
          { id: 'oh-1', name: 'Todd B. Finnerty, Psy.D.', state: 'Ohio', county: 'Franklin', type: 'Local', specialty: ['Mental Health', 'Headaches/Migraines'], services: 'Nexus letters ($600) & DBQs', contact: 'nexusletters.com', phone: '330-495-8809', email: 'toddfinnerty@toddfinnerty.com', notes: 'Adheres to APA Forensic Guidelines. Prolific.' },
          { id: 'oh-henderson', name: 'LaShelle Henderson, MSN, FNP-BC', state: 'Ohio', county: 'Cuyahoga', type: 'Local', specialty: ['Mental Health', 'General'], services: 'DBQ/IMO (PTSD, Anxiety, Insomnia)', contact: 'Search Web', phone: '', email: '', notes: '5241 Wilson Mills Rd Suite 35C.' },

          // --- OKLAHOMA ---
          { id: 'ok-1', name: 'John W. Ellis, MD', state: 'Oklahoma', county: 'Oklahoma City', type: 'Local', specialty: ['General', 'Legal Medicine', 'Back/Lumbar', 'Headaches/Migraines', 'ENT/Audiology'], services: 'IMOs, DBQs, Nexus letters', contact: 'ellisclinic.com', phone: '844-625-5300', email: '', notes: 'The Ellis Clinic. Historically high-volume IMO doctor.' },

          // --- OREGON ---
          { id: 'or-1', name: 'Suzanne Best, Ph.D.', state: 'Oregon', county: 'Multnomah', type: 'Local', specialty: ['Mental Health', 'PTSD'], services: 'DBQ Exams only', contact: 'suzannebestphd.com', phone: '503-468-6880', email: '', notes: 'Does not typically write nexus letters without exam.' },

          // --- PENNSYLVANIA ---
          { id: 'pa-mauthe', name: 'Dr. Robert A. Mauthe, MD', state: 'Pennsylvania', county: 'Lehigh', type: 'Local', specialty: ['Physical Medicine', 'Back/Lumbar', 'Legs', 'Extremities'], services: 'IMEs, Electrodiagnostic Medicine', contact: 'drmauthe.com', phone: '610-791-4848', email: '', notes: 'Physiatrist. Expert in back, neck, and extremity issues.' },
          { id: 'pa-ehrlich', name: 'Dr. Robert Ehrlich, MD', state: 'Pennsylvania', county: 'Philadelphia', type: 'Local', specialty: ['Physical Medicine', 'Rehabilitation'], services: 'IMEs, Disability Evaluations', contact: 'Search Web', phone: '215-333-8800', email: '', notes: 'Specializes in physical medicine independent medical exams.' },

          // --- RHODE ISLAND ---
          { id: 'ri-1', name: 'Dr. Jay Burstein, MD', state: 'Rhode Island', county: 'Providence', type: 'Local', specialty: ['Occupational Medicine', 'General', 'Back/Lumbar'], services: 'IMEs', contact: 'Search Web', phone: '401-272-3500', email: '', notes: 'Occupational medicine specialist.' },

          // --- SOUTH CAROLINA ---
          { id: 'sc-1', name: 'Nicole Y. Edwards, D.O.', state: 'South Carolina', county: 'Richland', type: 'Local', specialty: ['General', 'Family Medicine', 'Back/Lumbar', 'Headaches/Migraines', 'RESP'], services: 'C&P exams, DBQs, Nexus letters', contact: 'abundantcandp.com', phone: '803-995-7206', email: '', notes: 'High success in achieving increases. Broad gen-med DBQs.' },
          { id: 'sc-2', name: 'David Geier, MD', state: 'South Carolina', county: 'Charleston', type: 'Local', specialty: ['Orthopedic', 'Sports Medicine', 'Knees', 'Shoulders', 'Back/Lumbar'], services: 'Nexus letters & IMOs (Records)', contact: 'drdavidgeier.com', phone: '843-970-3485', email: '', notes: 'Explicitly offers orthopedic nexus letters. High credibility.' },
          { id: 'sc-sumter', name: 'Dr. Dezmond Sumter, MD', state: 'South Carolina', county: 'Richland', type: 'Local', specialty: ['General'], services: 'Nexus Letters', contact: 'premierphysiciangroup@gmail.com', phone: '', email: 'premierphysiciangroup@gmail.com', notes: 'Columbia, SC area.' },

          // --- SOUTH DAKOTA ---
          { id: 'sd-1', name: 'Telemedica (Serves SD)', state: 'South Dakota', county: 'Telehealth', type: 'Local', specialty: ['General', 'Mental Health', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Remote Nexus Letters', contact: 'telemedicallc.com', phone: '', email: '', notes: 'Primary verified option for SD.' },

          // --- TENNESSEE ---
          { id: 'tn-1', name: 'Dr. David Allen, MD', state: 'Tennessee', county: 'Statewide', type: 'Local', specialty: ['Psychiatry', 'Sleep Apnea', 'Headaches/Migraines'], services: 'Nexus Letters, Video Visits', contact: 'Search Web', phone: '', email: '', notes: 'Known as "Nexus Letter Doctor".' },

          // --- TEXAS ---
          { id: 'tx-1', name: 'Dr. Jerry Thompson, MD', state: 'Texas', county: 'Bexar', type: 'Local', specialty: ['General', 'Internal Medicine', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Nexus Letters, DBQs', contact: 'Search Web', phone: '', email: '', notes: 'Experienced with VA disability claims and medical opinions.' },
          { id: 'tx-2', name: 'Dr. Paul Saiz, MD', state: 'Texas', county: 'Statewide', type: 'Local', specialty: ['Orthopedic', 'Spine', 'Back/Lumbar'], services: 'Spine trauma, Disability evaluation', contact: 'Search Web', phone: '575-526-0777', email: '', notes: 'Certified Independent Medical Examiner (CIME). Specializes in spine.' },
          { id: 'tx-bucholz', name: 'Leah Bucholz, PA', state: 'Texas', county: 'Bexar', type: 'Local', specialty: ['General', 'Nexus Letters'], services: 'Nexus Letters', contact: 'Prestige World Wide Medical', phone: '', email: '', notes: 'Veteran. Prestige World Wide Medical Consulting.' },
          { id: 'tx-vmag', name: 'Veterans Medical Assistance Group', state: 'Texas', county: 'Bexar', type: 'Local', specialty: ['General', 'Multiple'], services: 'Nexus Letters, DBQs', contact: 'vmag4vets.com', phone: '', email: '', notes: 'Various doctors in San Antonio area.' },
          { id: 'tx-hawkins', name: 'Hawkins Psychiatry (Dr. Hawkins)', state: 'Texas', county: 'Tarrant', type: 'Local', specialty: ['Psychiatry'], services: 'Nexus Letters', contact: 'hawkinspsychiatry.com', phone: '', email: '', notes: 'Veteran.' },

          // --- UTAH ---
          { id: 'ut-1', name: 'Dr. David C. Peterson, MD', state: 'Utah', county: 'Salt Lake', type: 'Local', specialty: ['Neurology', 'TBI', 'Headaches/Migraines'], services: 'IMEs', contact: 'Search Web', phone: '801-269-8388', email: '', notes: 'Neurologist performing IMEs.' },

          // --- VERMONT ---
          { id: 'vt-1', name: 'Remington Nevin, MD, MPH', state: 'Vermont', county: 'Telehealth', type: 'Local', specialty: ['Toxic Exposure', 'Epidemiology', 'Headaches/Migraines'], services: 'Nexus letters', contact: 'remingtonnevin.com', phone: '', email: '', notes: 'Expert in anti-malarial drug effects/toxicity.' },

          // --- VIRGINIA ---
          { id: 'va-1', name: 'Dr. Gregory P. Smith, MD', state: 'Virginia', county: 'Fairfax', type: 'Local', specialty: ['General', 'Internal Medicine', 'Back/Lumbar', 'Headaches/Migraines'], services: 'Disability Evaluations, IMEs', contact: 'Search Web', phone: '', email: '', notes: 'Provides independent medical exams for disability claims.' },
          { id: 'va-munshower', name: 'Nicole Munshower, PA-C', state: 'Virginia', county: 'Chesapeake', type: 'Local', specialty: ['Orthopedic', 'MSK', 'Back/Lumbar', 'Joints'], services: 'DBQ/Exam', contact: 'Search Web', phone: '757-547-0027', email: '', notes: '1011 Eden Way, Suite G. Joint ROM/pain/function.' },

          // --- WASHINGTON ---
          { id: 'wa-1', name: 'Suzanne Best, Ph.D.', state: 'Washington', county: 'King', type: 'Local', specialty: ['Mental Health', 'PTSD'], services: 'DBQ Exams only', contact: 'suzannebestphd.com', phone: '503-468-6880', email: '', notes: 'Forensic evaluations for claims/appeals.' },
          { id: 'wa-3', name: 'Dr. Mark Leadbetter, MD', state: 'Washington', county: 'Onalaska', type: 'Local', specialty: ['Orthopedic', 'Extremities', 'Back/Lumbar'], services: 'L&I Approved Examiner', contact: '', phone: '360-978-6622', email: '', notes: 'L&I Approved. Orthopedics.' },
          { id: 'wa-4', name: 'Dr. Bruce Kite, MD', state: 'Washington', county: 'Yakima', type: 'Local', specialty: ['Neurology', 'Headaches/Migraines'], services: 'L&I Approved Examiner', contact: '', phone: '509-575-1000', email: '', notes: 'L&I Approved. Neurology.' },

          // --- WEST VIRGINIA ---
          { id: 'wv-1', name: 'Dr. Robert Ghiz, MD', state: 'West Virginia', county: 'Kanawha', type: 'Local', specialty: ['Occupational Medicine', 'General', 'Back/Lumbar'], services: 'IMEs', contact: 'Search Web', phone: '304-344-0100', email: '', notes: 'Occupational medicine specialist.' },

          // --- WISCONSIN ---
          { id: 'wi-1', name: 'Christine Erickson, Au.D.', state: 'Wisconsin', county: 'Dane', type: 'Local', specialty: ['Audiology', 'Hearing Loss'], services: 'Nexus letters & DBQs', contact: 'advancedaudiologyusa.com', phone: '608-577-1692', email: 'info@advancedaudiologyusa.com', notes: 'Forensic Audiologist. Can do remote Nexus.' },
          { id: 'wi-3', name: 'Dr. Timothy Allen, MD', state: 'Wisconsin', county: 'Milwaukee', type: 'Local', specialty: ['Mental Health', 'Forensic Psychiatry', 'Headaches/Migraines'], services: 'IMEs, Forensic Evaluations', contact: 'Search Web', phone: '414-727-2525', email: '', notes: 'Board-certified forensic psychiatrist. Strong IME background.' },
          { id: 'wi-4', name: 'Dr. Marc Novom, MD', state: 'Wisconsin', county: 'Outagamie', type: 'Local', specialty: ['Neurology', 'TBI', 'Headaches/Migraines'], services: 'IMEs, Neurological Evaluations', contact: 'Search Web', phone: '920-733-9600', email: '', notes: 'Specializes in TBI and neurological independent medical exams.' },
          { id: 'wi-garbelman', name: 'Dr. Jeffrey Garbelman, Psy.D.', state: 'Wisconsin', county: 'Milwaukee', type: 'Local', specialty: ['Mental Health', 'Psychology'], services: 'Nexus Letters', contact: 'wpapsychology.com', phone: '', email: '', notes: 'Watertown Psychological Assessment, LLC.' },

          // --- WYOMING ---
          { id: 'wy-1', name: 'Telemedica (Serves WY)', state: 'Wyoming', county: 'Telehealth', type: 'Local', specialty: ['General', 'Mental Health', 'Headaches/Migraines', 'Back/Lumbar'], services: 'Remote Nexus Letters', contact: 'telemedicallc.com', phone: '', email: '', notes: 'Primary verified option for WY.' },

          // --- NATIONAL / NETWORKS ---
          { id: 'nat-4', name: 'MedConnectVA', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Oncology', 'Neurology', 'Headaches/Migraines'], services: 'Written Nexus Opinions', contact: 'medconnectva.com', phone: '888-482-3627', email: '', notes: '50+ specialties. No clinic bottlenecks.' },
          { id: 'nat-ame', name: 'American Medical Experts', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Complex Cases', 'Headaches/Migraines'], services: 'Full Case Review', contact: '', phone: '888-678-2227', email: '', notes: 'Premium pricing, high quality specialists.' },
          { id: 'nat-cook', name: 'Dr. Cook, MD', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Occupational', 'Toxic Exposure'], services: 'IME/IMO/NEXUS', contact: 'medfitconsulting.com', phone: '', email: '', notes: 'MedFit Consulting. Toxicology/Occupational.' },
          { id: 'nat-seiter', name: 'Dr. Thomas Seiter, MD', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Radiology', 'Gait Analysis', 'MSK'], services: 'IMG / Radiology 2nd Opinions', contact: 'marian-medical.com', phone: '', email: '', notes: 'Marian Medical, LLC.' },
          { id: 'nat-brennes', name: 'Dr. William Andrew Brennes', state: 'National', county: 'Nationwide', type: 'National', specialty: ['General', 'Nexus Letters'], services: 'Nexus Letters', contact: 'nexusletterdoctor.com', phone: '', email: '', notes: 'Veteran-recommended. "Affordable" pricing.' },
          { id: 'nat-gardner', name: 'Jacqueline Gardner, PA-C', state: 'National', county: 'Nationwide', type: 'National', specialty: ['General', 'Audiology', 'Psychiatry'], services: 'Nexus Only', contact: 'MyVeteranNexusLetter.com', phone: '', email: '', notes: 'Nexus letters only.' },
          { id: 'nat-canty', name: 'Arrica Canty, RN', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Record Review', 'Consulting'], services: 'Medical Consulting', contact: 'mediscopeconsultants.com', phone: '', email: '', notes: 'Mediscope Consultants. RN/LNC Record Review.' },
          { id: 'nat-star', name: 'Star Medical Clinic', state: 'National', county: 'Nationwide', type: 'National', specialty: ['General', 'Nexus Letters'], services: 'Nexus Letters', contact: 'starmedicalclinic.com', phone: '', email: '', notes: 'Star Medical Clinic PLLC.' },
          { id: 'nat-mednick', name: 'Mednick Associates', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Legal', 'Medical Experts'], services: 'Nexus Letters (Attorneys Only)', contact: 'mednickassociates.com', phone: '203-966-3000', email: 'info@mednickassociates.com', notes: 'Works primarily with attorneys.' },
          { id: 'nat-sharp', name: 'Sharp Assessments', state: 'National', county: 'Nationwide', type: 'National', specialty: ['Mental Health'], services: 'Nexus Letters', contact: 'sharpassessmentsgroup.com', phone: '', email: '', notes: 'Mental Health focus.' },

          // --- RESOURCE NETWORKS (Separated) ---
          { id: 'net-seak', name: 'SEAK National Directory', state: 'National', county: 'Resource Directory', type: 'National', specialty: ['Resource', 'IME'], services: 'Directory of IMEs', contact: 'seakexperts.com', phone: '', email: '', notes: 'ACCME accredited training company.' },
          { id: 'net-imenet', name: 'IMENet', state: 'National', county: 'Resource Directory', type: 'National', specialty: ['Network', 'IME', 'Resource'], services: 'Searchable Directory of IMEs', contact: 'imenet.com', phone: '', email: '', notes: 'Extensive database of independent medical examiners.' },
          { id: 'nat-8', name: 'Xterra Health', state: 'National', county: 'Nationwide', type: 'National', specialty: ['General', 'Cardiology'], services: 'Nexus letters, IMOs', contact: 'xterrahealth.com', phone: '220-270-6090', email: '', notes: 'Mission to offer affordable access.' }
        ];

        // --- LOCAL STORAGE & STATE INIT ---
        const [providersData, setProvidersData] = useState(() => {
          const saved = localStorage.getItem('providersData');
          return saved && JSON.parse(saved).length > 20 ? JSON.parse(saved) : initialProviders;
        });

        const [adminNotes, setAdminNotes] = useState(() => {
          const saved = localStorage.getItem('adminNotes');
          return saved ? JSON.parse(saved) : {};
        });

        useEffect(() => {
          localStorage.setItem('providersData', JSON.stringify(providersData));
        }, [providersData]);

        useEffect(() => {
          localStorage.setItem('adminNotes', JSON.stringify(adminNotes));
        }, [adminNotes]);

        // --- FILTERING ---
        const [filteredProviders, setFilteredProviders] = useState([]);
        const [nationalProviders, setNationalProviders] = useState([]);

        const states = [
          "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia",
          "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
          "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire",
          "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania",
          "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington",
          "West Virginia", "Wisconsin", "Wyoming"
        ];

        const conditions = [
          "All", "Mental Health", "PTSD", "General", "Toxic Exposure", "Sleep Apnea", "Audiology", "Orthopedic", "Back/Lumbar", "Headaches/Migraines", "Legs/Knees", "Extremities", "Spine", "TBI", "Internal Medicine", "Resource", "Network"
        ];

        useEffect(() => {
          const filterFn = (p) => {
            const matchesState = selectedState ? p.state === selectedState : true;
            let matchesCondition = true;

            if (selectedCondition !== 'All') {
              const specialtyString = Array.isArray(p.specialty) ? p.specialty.join(' ').toLowerCase() : p.specialty.toLowerCase();
              const condLower = selectedCondition.toLowerCase();

              if (['back', 'legs', 'knees', 'extremities', 'spine', 'lumbar'].some(t => condLower.includes(t))) {
                matchesCondition = specialtyString.includes('orthopedic') || specialtyString.includes('physical medicine') || specialtyString.includes('musculoskeletal') || specialtyString.includes('spine') || specialtyString.includes('back') || specialtyString.includes('legs') || specialtyString.includes('extremities') || specialtyString.includes('msk');
              } else if (['headache', 'migraine', 'neurology'].some(t => condLower.includes(t))) {
                matchesCondition = specialtyString.includes('neurology') || specialtyString.includes('headache') || specialtyString.includes('migraine') || specialtyString.includes('neuroradiology');
              } else if (condLower === 'general') {
                matchesCondition = specialtyString.includes('general') || specialtyString.includes('family') || specialtyString.includes('internal');
              } else {
                matchesCondition = specialtyString.includes(condLower);
              }
            }

            const matchesSearch = searchQuery
              ? (p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                p.county.toLowerCase().includes(searchQuery.toLowerCase()) ||
                p.services.toLowerCase().includes(searchQuery.toLowerCase()))
              : true;

            return { matchesState, matchesCondition, matchesSearch };
          };

          setFilteredProviders(providersData.filter(p => {
            const { matchesState, matchesCondition, matchesSearch } = filterFn(p);
            return matchesState && matchesCondition && matchesSearch && p.type === 'Local';
          }));

          setNationalProviders(providersData.filter(p => {
            const isNetwork = Array.isArray(p.specialty) ? p.specialty.some(s => ['Network', 'Resource'].includes(s)) : p.specialty.includes('Network');
            const tabMatch = nationalTab === 'doctors' ? !isNetwork : isNetwork;
            const { matchesCondition, matchesSearch } = filterFn(p);
            return p.type === 'National' && matchesCondition && matchesSearch && tabMatch;
          }));

        }, [selectedState, selectedCondition, searchQuery, providersData, nationalTab]);

        // --- ACTIONS ---
        const updateAdminNote = (id, field, value) => {
          setAdminNotes(prev => ({
            ...prev,
            [id]: {
              ...prev[id],
              [field]: value
            }
          }));
        };

        const handleLogin = (e) => {
          e.preventDefault();
          if (loginForm.username === 'Admin' && loginForm.password === 'stateboys') {
            setIsAuthenticated(true);
            localStorage.setItem('auth_token', 'stateboys_session_active');
            setShowLoginModal(false);
            setLoginForm({ username: '', password: '' });
            setLoginError('');
            showToast('Logged in as Admin');
          } else {
            setLoginError('Invalid Credentials');
          }
        };

        const handleLogout = () => {
          setIsAuthenticated(false);
          localStorage.removeItem('auth_token');
          showToast('Logged Out Successfully');
        };

        const generateContentWithRetry = async (prompt, retries = 3) => {
          const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
          const payload = {
            contents: [{
              parts: [{ text: prompt }]
            }],
            tools: [{ google_search: {} }],
            generationConfig: { responseMimeType: "application/json" }
          };

          for (let i = 0; i < retries; i++) {
            try {
              const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });

              if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
              const data = await response.json();
              const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
              if (!text) throw new Error("No text generated");
              return JSON.parse(text);
            } catch (error) {
              if (i === retries - 1) throw error;
              await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
            }
          }
        };

        const runAutoScan = async () => {
          if (!apiKey) {
            showToast("API Key missing. Cannot run live scan.");
            return;
          }

          setIsScanning(true);
          const prompt = `Find a specific licensed medical provider in ${selectedState} (specifically near ${searchQuery || 'major cities'}) who writes VA Nexus Letters or completes DBQs for veterans, specifically for ${selectedCondition === 'All' ? 'general conditions' : selectedCondition}. Ensure they are a licensed MD, DO, PhD, or PA-C. Return JSON: { "name": "...", "county": "...", "specialty": ["..."], "services": "...", "contact": "...", "phone": "...", "email": "...", "notes": "..." }`;

          try {
            const providerData = await generateContentWithRetry(prompt);
            if (providerData) {
              const newProvider = {
                id: `auto-${Date.now()}`,
                name: providerData.name || `[Auto] ${selectedCondition} Specialist`,
                state: selectedState,
                county: providerData.county || 'Detected via Search',
                type: 'Local',
                specialty: providerData.specialty || ['General', 'Detected'],
                services: providerData.services || 'DBQ/Nexus (Needs Validation)',
                contact: providerData.contact || 'Web Search Result',
                phone: providerData.phone || '',
                email: providerData.email || '',
                notes: `[Auto-Detected] ${providerData.notes || 'System found this provider via live registry search.'}`
              };
              setProvidersData(prev => [...prev, newProvider]);
              showToast("Auto-Discovery Complete: Provider found and added.");
            } else {
              showToast("No providers found in this scan.");
            }
          } catch (error) {
            console.error("Scan failed:", error);
            showToast("Scan failed. Please try again.");
          } finally {
            setIsScanning(false);
          }
        };

        const copyToClipboard = (text) => {
          const textArea = document.createElement("textarea");
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand('copy');
            showToast(`Copied: ${text.substring(0, 20)}...`);
          } catch (err) { console.error(err); }
          document.body.removeChild(textArea);
        };

        const showToast = (message) => {
          setToast({ message });
          setTimeout(() => setToast(null), 3000);
        };

        const openProfile = (provider) => {
          setCurrentProvider(provider);
          setView('profile');
          window.scrollTo(0,0);
        };

        const handleAddSubmit = (e) => {
          e.preventDefault();
          const newEntry = {
            ...newProvider,
            id: `new-${Date.now()}`,
            specialty: newProvider.category === 'Network'
              ? ['Network', newProvider.specialty]
              : [newProvider.specialty],
            type: newProvider.state === 'Nationwide' ? 'National' : 'Local'
          };
          setProvidersData([...providersData, newEntry]);
          setShowAddModal(false);
          showToast("New Provider Added Successfully!");
          setNewProvider({ name: '', state: '', county: '', specialty: 'General', services: '', contact: '', phone: '', email: '', notes: '', type: 'Local', category: 'Doctor' });
        };

        // --- NEW PROVIDER FORM STATE ---
        const [newProvider, setNewProvider] = useState({
          name: '',
          state: '',
          county: '',
          specialty: 'General',
          services: '',
          contact: '',
          phone: '',
          email: '',
          notes: '',
          type: 'Local',
          category: 'Doctor'
        });

        // --- VIEW RENDER ---
        return (
          <div className="min-h-screen bg-slate-50 font-sans text-slate-800">

            {toast && (
              <div className="fixed top-5 right-5 z-50 bg-slate-800 text-white px-4 py-2 rounded-lg shadow-xl flex items-center gap-2 animate-bounce-in">
                <CheckCircle className="w-4 h-4 text-green-400" />
                <span className="text-sm font-medium">{toast.message}</span>
              </div>
            )}

            {/* Header */}
            <header className="bg-slate-900 text-white p-4 shadow-md border-b-4 border-red-600 sticky top-0 z-40">
              <div className="max-w-7xl mx-auto flex justify-between items-center">
                <div
                  className="cursor-pointer"
                  onClick={() => setView('list')}
                >
                  <h1 className="text-xl md:text-2xl font-bold flex items-center gap-2">
                    <span className="text-red-500"></span> Thank You For Your Service
                  </h1>
                </div>

                <div className="flex items-center gap-3">
                  {isAuthenticated ? (
                    <div
                      onClick={handleLogout}
                      className="flex items-center gap-2 px-3 py-1.5 rounded-full border border-red-500 bg-slate-800 cursor-pointer hover:bg-slate-700 transition-all"
                    >
                      <span className="text-xs font-bold text-red-400">Admin (Log Out)</span>
                      <LogOut className="w-4 h-4 text-red-400" />
                    </div>
                  ) : (
                    <div
                      onClick={() => setShowLoginModal(true)}
                      className="flex items-center gap-2 px-3 py-1.5 rounded-full border border-slate-600 bg-slate-800 cursor-pointer hover:bg-slate-700 transition-all"
                    >
                      <span className="text-xs font-bold text-slate-300">Log In</span>
                      <LogIn className="w-4 h-4 text-slate-300" />
                    </div>
                  )}

                  {view === 'list' && isAuthenticated && (
                    <button
                      onClick={() => setShowAddModal(true)}
                      className="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg shadow font-medium flex items-center gap-2 text-xs transition-colors"
                    >
                      <Plus className="w-3 h-3" /> Add
                    </button>
                  )}
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto p-4 md:p-6">

              {/* VIEW: PROFILE PAGE */}
              {view === 'profile' && currentProvider && (
                <ProviderProfile
                  provider={currentProvider}
                  onBack={() => setView('list')}
                  copyFn={copyToClipboard}
                  isAdmin={isAuthenticated}
                  adminState={adminNotes[currentProvider.id] || {}}
                  updateAdmin={updateAdminNote}
                  showToast={showToast}
                />
              )}

              {/* VIEW: LIST PAGE */}
              {view === 'list' && (
                <>
                  <section className="bg-white rounded-xl shadow-lg p-6 mb-8 border border-slate-200">
                    <div className="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                      <h2 className="text-xl font-semibold flex items-center gap-2 self-start md:self-center">
                        <Search className="w-5 h-5 text-blue-600" />
                        Find a Provider
                      </h2>
                      {(selectedState || selectedCondition !== 'All' || searchQuery) && (
                        <button
                          onClick={() => { setSelectedState(''); setSelectedCondition('All'); setSearchQuery(''); }}
                          className="text-sm text-red-600 hover:bg-red-50 px-3 py-1 rounded flex items-center gap-1 transition-colors self-end md:self-center"
                        >
                          <X className="w-4 h-4" /> Clear Filters
                        </button>
                      )}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div className="relative">
                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">State</label>
                        <div className="relative">
                          <MapPin className="absolute left-3 top-3 w-5 h-5 text-slate-400" />
                          <select
                            className="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none bg-white font-medium"
                            value={selectedState}
                            onChange={(e) => setSelectedState(e.target.value)}
                          >
                            <option value="">Select State...</option>
                            {states.map(state => <option key={state} value={state}>{state}</option>)}
                          </select>
                        </div>
                      </div>

                      <div className="relative">
                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Condition</label>
                        <div className="relative">
                          <Stethoscope className="absolute left-3 top-3 w-5 h-5 text-slate-400" />
                          <select
                            className="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none appearance-none bg-white font-medium"
                            value={selectedCondition}
                            onChange={(e) => setSelectedCondition(e.target.value)}
                          >
                            {conditions.map(cond => <option key={cond} value={cond}>{cond}</option>)}
                          </select>
                        </div>
                      </div>

                      <div className="relative">
                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Search</label>
                        <div className="relative">
                          <Search className="absolute left-3 top-3 w-5 h-5 text-slate-400" />
                          <input
                            type="text"
                            placeholder="Name, City, or Specialty..."
                            className="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-medium"
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                          />
                        </div>
                      </div>
                    </div>
                  </section>

                  <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">

                    {/* Main Results */}
                    <div className="lg:col-span-2 space-y-6">
                      <div className="flex justify-between items-end border-b border-slate-200 pb-2">
                        <h3 className="text-lg font-bold text-slate-800">
                          {selectedState ? `Providers in ${selectedState}` : 'Local Providers'}
                        </h3>
                        <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded font-medium">
                          {filteredProviders.length} Results
                        </span>
                      </div>

                      {filteredProviders.length > 0 ? (
                        filteredProviders.map(provider => (
                          <ProviderCard
                            key={provider.id}
                            provider={provider}
                            copyFn={copyToClipboard}
                            onViewProfile={() => openProfile(provider)}
                            isAdmin={isAuthenticated}
                            onDelete={() => {
                              setProvidersData(prev => prev.filter(p => p.id !== provider.id));
                              showToast("Provider Removed");
                            }}
                          />
                        ))
                      ) : (
                        selectedState && (
                          <div className="bg-slate-50 border-2 border-dashed border-slate-300 rounded-xl p-8 text-center">
                            <div className="flex justify-center mb-4">
                              <div className="bg-blue-100 p-3 rounded-full">
                                <Globe className="w-8 h-8 text-blue-600" />
                              </div>
                            </div>
                            <h4 className="text-lg font-bold text-slate-800 mb-2">No Verified Local Providers in {selectedState}</h4>
                            <p className="text-slate-500 text-sm mb-6 max-w-md mx-auto">
                              We haven't manually verified a specialist in this state yet. Use our automated tool to find potential leads.
                            </p>

                            {isAuthenticated ? (
                              isScanning ? (
                                <button disabled type="button" className="bg-slate-200 text-slate-500 font-bold py-3 px-6 rounded-lg flex items-center gap-3 mx-auto cursor-not-allowed">
                                  <Loader className="w-5 h-5 animate-spin" />
                                  Scanning Registries...
                                </button>
                              ) : (
                                <button
                                  type="button"
                                  onClick={runAutoScan}
                                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2 mx-auto"
                                >
                                  <Database className="w-5 h-5" />
                                  Launch Auto-Discovery Bot
                                </button>
                              )
                            ) : (
                              <div className="flex items-center justify-center gap-2 text-slate-400 text-sm bg-white p-2 rounded border border-slate-200 inline-block">
                                <Lock className="w-3 h-3" /> Log in to use Auto-Discovery
                              </div>
                            )}
                          </div>
                        )
                      )}
                    </div>

                    {/* National Sidebar */}
                    <div className="lg:col-span-1">
                      <div className="bg-slate-800 text-white rounded-t-xl overflow-hidden shadow-lg sticky top-24">
                        <div className="p-4 flex justify-between items-center border-b border-slate-700">
                          <h3 className="font-bold flex items-center gap-2">
                            <Globe className="w-5 h-5 text-blue-300" />
                            National
                          </h3>
                          <button type="button" onClick={() => setShowNational(!showNational)} className="text-xs bg-slate-700 hover:bg-slate-600 px-2 py-1 rounded transition-colors">{showNational ? 'Hide' : 'Show'}</button>
                        </div>

                        {showNational && (
                          <>
                            <div className="flex text-xs font-bold text-center bg-slate-700 uppercase tracking-wide">
                              <button type="button" className={`flex-1 py-3 ${nationalTab === 'doctors' ? 'bg-white text-slate-900 border-t-2 border-red-500' : 'text-slate-400 hover:bg-slate-600'}`} onClick={() => setNationalTab('doctors')}>Telehealth Doctors</button>
                              <button type="button" className={`flex-1 py-3 ${nationalTab === 'networks' ? 'bg-white text-slate-900 border-t-2 border-purple-500' : 'text-slate-400 hover:bg-slate-600'}`} onClick={() => setNationalTab('networks')}>Networks</button>
                            </div>

                            <div className="bg-white border border-slate-200 border-t-0 rounded-b-xl shadow-lg p-3 space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto">
                              {nationalProviders.length > 0 ? (
                                nationalProviders.map(provider => (
                                  <NationalProviderCard
                                    key={provider.id}
                                    provider={provider}
                                    copyFn={copyToClipboard}
                                    onViewProfile={() => openProfile(provider)}
                                    isAdmin={isAuthenticated}
                                    onDelete={() => setProvidersData(prev => prev.filter(p => p.id !== provider.id))}
                                  />
                                ))
                              ) : (
                                <p className="text-center text-sm text-slate-400 py-8">No matching providers.</p>
                              )}
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  </div>
                </>
              )}
            </main>

            {/* --- LOGIN MODAL --- */}
            {showLoginModal && (
              <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-bounce-in">
                  <div className="bg-slate-900 p-6 text-center">
                    <h2 className="text-white font-bold text-xl mb-1">Admin Access</h2>
                    <p className="text-slate-400 text-sm">Secure Provider Database</p>
                  </div>
                  <form onSubmit={handleLogin} className="p-6 space-y-4">
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Username</label>
                      <input
                        type="text"
                        className="w-full border border-slate-300 rounded p-2 focus:ring-2 focus:ring-blue-500 outline-none"
                        value={loginForm.username}
                        onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                      />
                    </div>
                    <div>
                      <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Password</label>
                      <input
                        type="password"
                        className="w-full border border-slate-300 rounded p-2 focus:ring-2 focus:ring-blue-500 outline-none"
                        value={loginForm.password}
                        onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                      />
                    </div>
                    {loginError && <p className="text-red-500 text-xs font-bold text-center">{loginError}</p>}
                    <div className="flex gap-2 pt-2">
                      <button type="button" onClick={() => setShowLoginModal(false)} className="flex-1 py-2 bg-slate-100 text-slate-600 font-bold rounded hover:bg-slate-200">Cancel</button>
                      <button type="submit" className="flex-1 py-2 bg-blue-600 text-white font-bold rounded hover:bg-blue-700">Log In</button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* --- ADD PROVIDER MODAL --- */}
            {showAddModal && (
              <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden animate-bounce-in">
                  <div className="bg-slate-900 text-white p-4 flex justify-between items-center">
                    <h3 className="text-lg font-bold flex items-center gap-2"><UserPlus className="w-5 h-5 text-red-500" /> Add New Provider</h3>
                    <button type="button" onClick={() => setShowAddModal(false)} className="text-slate-400 hover:text-white"><X className="w-6 h-6" /></button>
                  </div>
                  <form onSubmit={handleAddSubmit} className="p-6 space-y-4">
                    <div className="flex gap-4 p-1 bg-slate-100 rounded-lg">
                      <label className={`flex-1 text-center py-2 rounded cursor-pointer text-sm font-medium ${newProvider.category === 'Doctor' ? 'bg-white shadow text-blue-700' : 'text-slate-500'}`}>
                        <input type="radio" name="category" className="hidden" checked={newProvider.category === 'Doctor'} onChange={() => setNewProvider({ ...newProvider, category: 'Doctor' })} /> Individual Doctor
                      </label>
                      <label className={`flex-1 text-center py-2 rounded cursor-pointer text-sm font-medium ${newProvider.category === 'Network' ? 'bg-white shadow text-purple-700' : 'text-slate-500'}`}>
                        <input type="radio" name="category" className="hidden" checked={newProvider.category === 'Network'} onChange={() => setNewProvider({ ...newProvider, category: 'Network' })} /> Network / Resource
                      </label>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">Provider Name *</label>
                      <input required type="text" className="w-full border border-slate-300 rounded px-3 py-2" value={newProvider.name} onChange={e => setNewProvider({ ...newProvider, name: e.target.value })} />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div><label className="block text-sm font-medium text-slate-700 mb-1">State *</label><select required className="w-full border border-slate-300 rounded px-3 py-2" value={newProvider.state} onChange={e => setNewProvider({ ...newProvider, state: e.target.value })}><option value="">Select...</option><option value="Nationwide">Nationwide</option>{states.map(s => <option key={s} value={s}>{s}</option>)}</select></div>
                      <div><label className="block text-sm font-medium text-slate-700 mb-1">City/County</label><input type="text" className="w-full border border-slate-300 rounded px-3 py-2" value={newProvider.county} onChange={e => setNewProvider({ ...newProvider, county: e.target.value })} /></div>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div><label className="block text-sm font-medium text-slate-700 mb-1">Specialty</label><select className="w-full border border-slate-300 rounded px-3 py-2" value={newProvider.specialty} onChange={e => setNewProvider({ ...newProvider, specialty: e.target.value })}>{conditions.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
                      <div><label className="block text-sm font-medium text-slate-700 mb-1">Phone</label><input type="text" className="w-full border border-slate-300 rounded px-3 py-2" value={newProvider.phone} onChange={e => setNewProvider({ ...newProvider, phone: e.target.value })} /></div>
                    </div>
                    <div><label className="block text-sm font-medium text-slate-700 mb-1">Email</label><input type="email" className="w-full border border-slate-300 rounded px-3 py-2" value={newProvider.email} onChange={e => setNewProvider({ ...newProvider, email: e.target.value })} /></div>
                    <div><label className="block text-sm font-medium text-slate-700 mb-1">Services</label><textarea className="w-full border border-slate-300 rounded px-3 py-2 h-20" value={newProvider.notes} onChange={e => setNewProvider({ ...newProvider, notes: e.target.value })} /></div>
                    <button type="submit" className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg shadow-lg flex justify-center items-center gap-2 mt-4"><Save className="w-5 h-5" /> Save Provider</button>
                  </form>
                </div>
              </div>
            )}
          </div>
        );
      };

      // --- COMPONENT: PROFILE VIEW ---
      const ProviderProfile = ({ provider, onBack, copyFn, isAdmin, adminState, updateAdmin, showToast }) => {
        const isResource = provider.specialty.includes('Resource');

        const handleSaveNote = () => {
          showToast("Admin notes saved to backend.");
        };

        const cleanPhone = (phone) => phone ? phone.replace(/[^\d+]/g, '') : '';

        return (
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            {/* LEFT COL: Basic Info */}
            <div className="lg:col-span-2 space-y-6">
              <button type="button" onClick={onBack} className="flex items-center gap-2 text-slate-500 hover:text-blue-600 font-medium transition-colors mb-2">
                <ArrowLeft className="w-4 h-4" /> Back to Directory
              </button>

              <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                <div className={`h-24 ${isResource ? 'bg-amber-100' : 'bg-blue-600'} relative`}>
                  <div className="absolute -bottom-10 left-8">
                    <div className="w-20 h-20 bg-white rounded-full p-1 shadow-md flex items-center justify-center">
                      {isResource ? <Database className="w-10 h-10 text-amber-500" /> : <Stethoscope className="w-10 h-10 text-blue-500" />}
                    </div>
                  </div>
                </div>
                <div className="pt-12 pb-8 px-8">
                  <div className="flex justify-between items-start">
                    <div>
                      <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-2">
                        {provider.name}
                        {!provider.id.includes('auto') && <ShieldCheck className="w-6 h-6 text-blue-500" title="Verified" />}
                      </h1>
                      <p className="text-slate-500 flex items-center gap-2 mt-1">
                        <MapPin className="w-4 h-4" /> {provider.county}, {provider.state}
                      </p>
                    </div>
                    <div className="text-right">
                      <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide ${provider.type === 'National' ? 'bg-purple-100 text-purple-700' : 'bg-green-100 text-green-700'}`}>
                        {provider.type}
                      </span>
                    </div>
                  </div>

                  {/* Badges */}
                  <div className="flex flex-wrap gap-2 mt-6">
                    {provider.specialty.map((s, i) => (
                      <span key={i} className="bg-slate-100 text-slate-600 px-3 py-1 rounded-md text-xs font-bold border border-slate-200">
                        {s}
                      </span>
                    ))}
                  </div>

                  {/* Action Bar */}
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                    {provider.phone ? (
                      <>
                        <button
                          type="button"
                          onClick={() => window.location.href = `tel:${cleanPhone(provider.phone)}`}
                          className="flex flex-col items-center justify-center gap-2 bg-blue-50 text-blue-700 p-4 rounded-xl hover:bg-blue-100 transition-colors"
                        >
                          <Phone className="w-6 h-6" /> <span className="font-bold text-sm">Call</span>
                        </button>
                        <button
                          type="button"
                          onClick={() => window.location.href = `sms:${cleanPhone(provider.phone)}`}
                          className="flex flex-col items-center justify-center gap-2 bg-green-50 text-green-700 p-4 rounded-xl hover:bg-green-100 transition-colors"
                        >
                          <MessageSquare className="w-6 h-6" /> <span className="font-bold text-sm">Text</span>
                        </button>
                      </>
                    ) : (
                      <div className="col-span-2 flex flex-col items-center justify-center gap-2 bg-slate-50 text-slate-400 p-4 rounded-xl border border-slate-200">
                        <Phone className="w-6 h-6" /> <span className="font-bold text-sm">No Phone</span>
                      </div>
                    )}

                    {provider.contact && !provider.contact.includes('@') ? (
                      <button
                        type="button"
                        onClick={() => window.open(`https://${provider.contact.replace(/^https?:\/\//, '')}`, '_blank')}
                        className="flex flex-col items-center justify-center gap-2 bg-slate-50 text-slate-700 p-4 rounded-xl border border-slate-200 hover:bg-slate-100 transition-colors"
                      >
                        <Globe className="w-6 h-6" /> <span className="font-bold text-sm">Website</span>
                      </button>
                    ) : (
                      <button type="button" onClick={() => copyFn(provider.contact)} className="flex flex-col items-center justify-center gap-2 bg-slate-50 text-slate-700 p-4 rounded-xl border border-slate-200 hover:bg-slate-100 transition-colors">
                        <Mail className="w-6 h-6" /> <span className="font-bold text-sm">Email</span>
                      </button>
                    )}

                    <button type="button" onClick={() => copyFn(`${provider.name}\n${provider.phone || ''}`)} className="flex flex-col items-center justify-center gap-2 bg-white text-slate-600 p-4 rounded-xl border border-slate-200 hover:shadow-md transition-all">
                      <Copy className="w-6 h-6" /> <span className="font-bold text-sm">Copy Info</span>
                    </button>
                  </div>
                </div>
              </div>

              {/* Details Section */}
              <div className="bg-white rounded-xl shadow-lg border border-slate-200 p-8">
                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <FileText className="w-5 h-5 text-blue-500" /> Services & Details
                </h3>
                <div className="space-y-4">
                  {/* New Contact Info Section */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-slate-50 p-4 rounded-lg border border-slate-100 flex items-start gap-3">
                      <Smartphone className="w-5 h-5 text-slate-400 mt-0.5" />
                      <div>
                        <p className="text-xs text-slate-500 font-bold uppercase mb-1">Phone Number</p>
                        <p className="text-slate-900 font-medium select-all">{provider.phone || 'Not Listed'}</p>
                      </div>
                    </div>
                    <div className="bg-slate-50 p-4 rounded-lg border border-slate-100 flex items-start gap-3">
                      <AtSign className="w-5 h-5 text-slate-400 mt-0.5" />
                      <div className="w-full">
                        <p className="text-xs text-slate-500 font-bold uppercase mb-1">Email / Web</p>
                        <p className="text-slate-900 font-medium select-all break-all">{provider.email || provider.contact}</p>
                      </div>
                    </div>
                  </div>

                  <div className="bg-slate-50 p-4 rounded-lg border border-slate-100">
                    <p className="text-xs text-slate-500 font-bold uppercase mb-1">Services Offered</p>
                    <p className="text-slate-800 font-medium">{provider.services}</p>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-lg border border-slate-100">
                    <p className="text-xs text-slate-500 font-bold uppercase mb-1">Additional Notes</p>
                    <p className="text-slate-700 italic">{provider.notes}</p>
                  </div>
                </div>
              </div>
            </div>

            {/* RIGHT COL: Admin / Status */}
            <div className="lg:col-span-1 space-y-6">
              {isAdmin ? (
                <div className="bg-white rounded-xl shadow-lg border-t-4 border-red-500 overflow-hidden">
                  <div className="bg-slate-50 p-4 border-b border-slate-200">
                    <h3 className="font-bold text-slate-800 flex items-center gap-2">
                      <Shield className="w-5 h-5 text-red-500" /> Admin CRM
                    </h3>
                  </div>

                  <div className="p-5 space-y-6">
                    {/* Status Toggles */}
                    <div className="space-y-3">
                      <p className="text-xs font-bold text-slate-400 uppercase tracking-wider">Relationship Status</p>
                      <label className="flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer transition-colors">
                        <div className={`w-5 h-5 rounded border flex items-center justify-center ${adminState.reachedOut ? 'bg-blue-600 border-blue-600 text-white' : 'bg-white border-slate-300'}`}>
                          {adminState.reachedOut && <CheckCircle className="w-3 h-3" />}
                        </div>
                        <input type="checkbox" className="hidden" checked={adminState.reachedOut || false} onChange={(e) => updateAdmin(provider.id, 'reachedOut', e.target.checked)} />
                        <span className="text-sm font-medium text-slate-700">Reached Out</span>
                      </label>

                      <label className="flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer transition-colors">
                        <div className={`w-5 h-5 rounded border flex items-center justify-center ${adminState.workingWith ? 'bg-green-600 border-green-600 text-white' : 'bg-white border-slate-300'}`}>
                          {adminState.workingWith && <CheckCircle className="w-3 h-3" />}
                        </div>
                        <input type="checkbox" className="hidden" checked={adminState.workingWith || false} onChange={(e) => updateAdmin(provider.id, 'workingWith', e.target.checked)} />
                        <span className="text-sm font-medium text-slate-700">Active w/ Patient</span>
                      </label>

                      <label className="flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer transition-colors">
                        <div className={`w-5 h-5 rounded border flex items-center justify-center ${adminState.fullTimeInterest ? 'bg-purple-600 border-purple-600 text-white' : 'bg-white border-slate-300'}`}>
                          {adminState.fullTimeInterest && <CheckCircle className="w-3 h-3" />}
                        </div>
                        <input type="checkbox" className="hidden" checked={adminState.fullTimeInterest || false} onChange={(e) => updateAdmin(provider.id, 'fullTimeInterest', e.target.checked)} />
                        <span className="text-sm font-medium text-slate-700">Potential Full-Time</span>
                      </label>
                    </div>

                    {/* Notes Log */}
                    <div className="space-y-2">
                      <p className="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center justify-between">
                        Internal Notes Log
                        <span className="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-500">Private</span>
                      </p>
                      <textarea
                        className="w-full h-40 p-3 text-sm border border-slate-300 rounded-lg bg-yellow-50 focus:ring-2 focus:ring-yellow-400 focus:border-transparent outline-none resize-none"
                        placeholder="Log calls, emails, and notes here..."
                        value={adminState.notes || ''}
                        onChange={(e) => updateAdmin(provider.id, 'notes', e.target.value)}
                      />
                      <button
                        type="button"
                        onClick={handleSaveNote}
                        className="w-full bg-slate-800 text-white text-xs font-bold py-2 rounded hover:bg-slate-700 transition-colors flex items-center justify-center gap-2"
                      >
                        <Save className="w-3 h-3" /> Save Log Entry
                      </button>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="bg-slate-100 rounded-xl p-6 text-center border border-slate-200">
                  <Shield className="w-8 h-8 text-slate-300 mx-auto mb-2" />
                  <h3 className="font-bold text-slate-500">Admin Area Locked</h3>
                  <p className="text-xs text-slate-400 mt-1">Enable "Admin View" in the header to log notes and track status for this provider.</p>
                </div>
              )}
            </div>
          </div>
        );
      };

      // --- COMPONENT: LIST CARD (Simplified for cleaner listing) ---
      const ProviderCard = ({ provider, copyFn, onViewProfile, isAdmin, onDelete }) => {
        const isResource = provider.specialty.includes('Resource');
        const cleanPhone = (phone) => phone ? phone.replace(/[^\d+]/g, '') : '';

        return (
          <div className={`relative rounded-xl shadow-sm border transition-all duration-200 ${isResource ? 'bg-amber-50 border-amber-200' : 'bg-white border-slate-200 hover:shadow-md'}`}>
            {isAdmin && (
              <button type="button" onClick={onDelete} className="absolute top-2 right-2 p-1.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded transition-colors z-10">
                <Trash2 className="w-4 h-4" />
              </button>
            )}
            <div className="p-5">
              <div className="flex justify-between items-start mb-2 pr-6">
                <div>
                  <h4 className={`font-bold text-lg cursor-pointer hover:underline ${isResource ? 'text-amber-900' : 'text-slate-900'}`} onClick={onViewProfile}>
                    {provider.name}
                  </h4>
                  <p className="text-sm text-slate-500 flex items-center gap-1">
                    <MapPin className="w-3 h-3" /> {provider.county}, {provider.state}
                  </p>
                </div>
              </div>
              <div className="flex flex-wrap gap-1.5 mb-4">
                {provider.specialty.slice(0, 3).map((spec, idx) => (
                  <span key={idx} className="text-[10px] uppercase font-bold px-2 py-1 rounded bg-slate-100 text-slate-600 border border-slate-200">{spec}</span>
                ))}
              </div>
              <div className="grid grid-cols-2 gap-2">
                <button type="button" onClick={onViewProfile} className="col-span-1 flex items-center justify-center gap-1 text-sm font-bold py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors">
                  View Profile
                </button>
                <div className="grid grid-cols-2 gap-2">
                  {provider.phone ? (
                    <button type="button" onClick={() => window.location.href = `tel:${cleanPhone(provider.phone)}`} className="flex items-center justify-center bg-slate-100 rounded-lg hover:bg-slate-200 text-slate-600 transition-colors"><Phone className="w-4 h-4" /></button>
                  ) : <div className="bg-slate-50 rounded-lg opacity-50 flex items-center justify-center"><Phone className="w-4 h-4" /></div>}
                  <button type="button" onClick={() => copyFn(provider.contact)} className="flex items-center justify-center bg-slate-100 rounded-lg hover:bg-slate-200 text-slate-600 transition-colors"><Copy className="w-4 h-4" /></button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // --- NATIONAL CARD ---
      const NationalProviderCard = ({ provider, copyFn, onViewProfile, isAdmin, onDelete }) => {
        const cleanPhone = (phone) => phone ? phone.replace(/[^\d+]/g, '') : '';

        return (
          <div className="bg-slate-50 rounded-lg border border-slate-200 p-3 hover:border-blue-300 transition-colors relative">
            {isAdmin && <button type="button" onClick={onDelete} className="absolute top-1 right-1 p-1 text-slate-300 hover:text-red-500"><X className="w-3 h-3" /></button>}
            <div className="flex justify-between items-center mb-1">
              <h5 className="font-bold text-sm text-slate-800 line-clamp-1 cursor-pointer hover:text-blue-600" onClick={onViewProfile}>{provider.name}</h5>
              <Video className="w-3 h-3 text-blue-500 shrink-0 ml-2" />
            </div>
            <div className="flex flex-wrap gap-1 mb-2">
              {provider.specialty.slice(0, 2).map((s, i) => <span key={i} className="text-[9px] bg-white border border-slate-200 px-1.5 py-0.5 rounded text-slate-500 uppercase">{s}</span>)}
            </div>
            <div className="flex gap-2 mt-2 pt-2 border-t border-slate-200">
              <button type="button" onClick={onViewProfile} className="flex-1 flex items-center justify-center gap-1 text-[10px] font-bold bg-white border border-slate-300 text-slate-600 py-1.5 rounded hover:bg-slate-50">Profile</button>
              {provider.phone && <button type="button" onClick={() => window.location.href = `tel:${cleanPhone(provider.phone)}`} className="flex-1 flex items-center justify-center gap-1 text-[10px] font-bold bg-blue-100 text-blue-700 py-1.5 rounded hover:bg-blue-200">Call</button>}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(rootElement);
      root.render(<ProviderFinder />);
    }
  </script>
</body>
</html>
